<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="Grok's Circuit Escape - Help Grok collect chips and defeat viruses!" />
    <link rel="manifest" href="/manifest.json" />
    <title>Grok's Circuit Escape</title>
    <style>
      * { margin:0; padding:0; box-sizing:border-box; }
      html, body { width:100%; height:100%; overflow:hidden; background:#000; }
      #root { width:100vw; height:100vh; }
      .controls { position:fixed; bottom:0; left:0; right:0; height:100px; display:flex; justify-content:space-between; align-items:center; padding:0 20px; z-index:1000; }
      .joy { width:80px; height:80px; background:rgba(255,255,255,0.3); border-radius:50%; }
      .jump { width:70px; height:70px; background:#4f46e5; color:white; border-radius:50%; font-size:36px; display:flex; align-items:center; justify-content:center; }
    </style>
  </head>
  <body>
    <noscript>You need JavaScript to play.</noscript>
    <div id="root"></div>

    <!-- Mobile Controls -->
    <div class="controls">
      <div class="joy" id="joystick"></div>
      <div class="jump" id="jumpBtn">â†‘</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.10.1/dist/nipplejs.min.js"></script>
    <script>
      // Auto-start game
      window.addEventListener('load', () => {
        setTimeout(() => {
          const playButton = document.querySelector('button');
          if (playButton) playButton.click();
        }, 500);
      });

      // Mobile Joystick
      const manager = nipplejs.create({
        zone: document.getElementById('joystick'),
        mode: 'static',
        position: { left: '50%', top: '50%' },
        color: 'white'
      });

      let left = false, right = false;
      manager.on('move', (evt, data) => {
        if (data.direction) {
          left = data.direction.x === 'left';
          right = data.direction.x === 'right';
        }
      });
      manager.on('end', () => { left = right = false; });

      // Jump Button
      const jumpBtn = document.getElementById('jumpBtn');
      jumpBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        window.dispatchEvent(new KeyboardEvent('keydown', {key: ' '}));
      });
      jumpBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        window.dispatchEvent(new KeyboardEvent('keyup', {key: ' '}));
      });

      // Simulate arrow keys
      setInterval(() => {
        ['ArrowLeft', 'ArrowRight'].forEach(key => {
          const pressed = (key === 'ArrowLeft' && left) || (key === 'ArrowRight' && right);
          if (pressed) {
            window.dispatchEvent(new KeyboardEvent('keydown', {key}));
          } else {
            window.dispatchEvent(new KeyboardEvent('keyup', {key}));
          }
        });
      }, 16);
    </script>
  </body>
</html>
