<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="Grok's Circuit Escape - Help Grok collect chips and defeat viruses!" />
    <link rel="manifest" href="/manifest.json" />
    <title>Grok's Circuit Escape</title>
    <style>
      * { margin:0; padding:0; box-sizing:border-box; }
      html, body, #root { width:100%; height:100%; overflow:hidden; }
      .game-container { width:100vw; height:100vh; position:relative; }
      canvas { width:100% !important; height:100% !important; }
      .controls { position:fixed; bottom:20px; left:20px; right:20px; display:flex; justify-content:space-between; z-index:1000; }
      .joy, .jump { width:70px; height:70px; background:rgba(255,255,255,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:32px; color:white; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- Mobile Controls -->
    <div class="controls">
      <div class="joy" id="joystick"></div>
      <div class="jump" id="jumpBtn">â†‘</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.10.1/dist/nipplejs.min.js"></script>
    <script>
      // Force Landscape
      if (screen.orientation) screen.orientation.lock('landscape').catch(() => {});

      // Auto-start
      window.addEventListener('load', () => {
        setTimeout(() => {
          const btn = document.querySelector('button');
          if (btn) btn.click();
        }, 500);
      });

      // Joystick
      const manager = nipplejs.create({
        zone: document.getElementById('joystick'),
        mode: 'static',
        position: { left: '50%', top: '50%' },
        color: 'white'
      });

      let left = false, right = false;
      manager.on('move', (evt, data) => {
        left = data.direction?.x === 'left';
        right = data.direction?.x === 'right';
      });
      manager.on('end', () => { left = right = false; });

      // Jump
      document.getElementById('jumpBtn').addEventListener('touchstart', e => {
        e.preventDefault();
        window.dispatchEvent(new KeyboardEvent('keydown', {key: ' '}));
      });
      document.getElementById('jumpBtn').addEventListener('touchend', e => {
        e.preventDefault();
        window.dispatchEvent(new KeyboardEvent('keyup', {key: ' '}));
      });

      // Simulate keys
      setInterval(() => {
        ['ArrowLeft', 'ArrowRight'].forEach(k => {
          const down = (k === 'ArrowLeft' && left) || (k === 'ArrowRight' && right);
          window.dispatchEvent(new KeyboardEvent(down ? 'keydown' : 'keyup', {key: k}));
        });
      }, 16);
    </script>
  </body>
</html>
