<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="Grok's Circuit Escape" />
    <link rel="manifest" href="/manifest.json" />
    <title>Grok's Circuit Escape</title>
    <style>
      * { margin:0; padding:0; box-sizing:border-box; }
      html, body { width:100%; height:100%; overflow:hidden; background:url('bg.jpg') center/cover; }
      #root { width:100vw; height:100vh; position:relative; }

      /* LANDING PAGE */
      .landing {
        position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15,23,42,0.95); 
        display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000; color:white;
      }
      .title { font-size:36px; font-weight:bold; margin-bottom:20px; }
      .btn { background:#4f46e5; color:white; padding:15px 40px; margin:10px; border-radius:50px; font-size:20px; border:none; }
      .btn:active { transform:scale(0.95); }

      /* HIDE LEADERBOARD & UI */
      .leaderboard, [class*="leaderboard"], [id*="leaderboard"], 
      [class*="Powerups"], [class*="Score"], [class*="Level"] { display:none !important; }

      /* MOBILE CONTROLS */
      .controls {
        position:fixed; bottom:15px; left:15px; right:15px; display:flex; justify-content:space-between; z-index:999;
      }
      .joy, .jump {
        width:80px; height:80px; background:rgba(255,255,255,0.4); border-radius:50%; 
        display:flex; align-items:center; justify-content:center; font-size:36px; color:white; backdrop-filter:blur(5px);
      }

      /* FULL-BODY ANIMATED GROK */
      .grok-player {
        width: 80px; height: 120px;
        background: url('grok-walk.png') 0 0 / 400% 100% no-repeat;
        animation: walk 0.6s steps(4) infinite;
        position: absolute; bottom: 80px; left: 50px; z-index: 10;
      }
      @keyframes walk {
        from { background-position: 0 0; }
        to { background-position: -320px 0; }
      }
    </style>
  </head>
  <body>
    <!-- LANDING PAGE -->
    <div class="landing" id="landing">
      <h1 class="title">Grok's Circuit Escape</h1>
      <button class="btn" id="startBtn">Start Game</button>
      <button class="btn" id="howtoBtn">How to Play</button>
    </div>

    <!-- HOW TO PLAY -->
    <div class="landing" id="howto" style="display:none;">
      <h1 class="title">How to Play</h1>
      <p style="max-width:80%; text-align:center; margin:15px 0;">Swipe left/right to move<br>Tap â†‘ to jump<br>Collect chips, avoid viruses!</p>
      <button class="btn" id="closeHowto">Back</button>
    </div>

    <div id="root"></div>

    <!-- FULL-BODY GROK -->
    <div class="grok-player" id="grok"></div>

    <!-- MOBILE CONTROLS -->
    <div class="controls">
      <div class="joy" id="joystick"></div>
      <div class="jump" id="jumpBtn">Jump</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.10.1/dist/nipplejs.min.js"></script>
    <script>
      // LANDING PAGE
      document.getElementById('startBtn').onclick = () => document.getElementById('landing').style.display = 'none';
      document.getElementById('howtoBtn').onclick = () => document.getElementById('howto').style.display = 'flex';
      document.getElementById('closeHowto').onclick = () => { 
        document.getElementById('howto').style.display = 'none'; 
        document.getElementById('landing').style.display = 'flex'; 
      };

      // FORCE LANDSCAPE
      if (screen.orientation) screen.orientation.lock('landscape').catch(() => {});

      // AUTO-START
      document.getElementById('startBtn').addEventListener('click', () => {
        setTimeout(() => {
          const play = document.querySelector('button');
          if (play) play.click();
        }, 300);
      });

      // MOBILE CONTROLS
      const manager = nipplejs.create({
        zone: document.getElementById('joystick'),
        mode: 'static',
        position: { left: '50%', top: '50%' },
        color: 'white'
      });

      let left = false, right = false;
      manager.on('move', (e, data) => {
        left = data.direction?.x === 'left';
        right = data.direction?.x === 'right';
      });
      manager.on('end', () => { left = right = false; });

      document.getElementById('jumpBtn').addEventListener('touchstart', e => {
        e.preventDefault();
        window.dispatchEvent(new KeyboardEvent('keydown', {key: ' '}));
      });
      document.getElementById('jumpBtn').addEventListener('touchend', e => {
        e.preventDefault();
        window.dispatchEvent(new KeyboardEvent('keyup', {key: ' '}));
      });

      // SIMULATE KEYS + MOVE GROK
      const grok = document.getElementById('grok');
      let posX = 50;
      setInterval(() => {
        if (left && posX > 0) posX -= 6;
        if (right && posX < window.innerWidth - 100) posX += 6;
        grok.style.left = posX + 'px';

        ['ArrowLeft', 'ArrowRight'].forEach(k => {
          const down = (k === 'ArrowLeft' && left) || (k === 'ArrowRight' && right);
          window.dispatchEvent(new KeyboardEvent(down ? 'keydown' : 'keyup', {key: k}));
        });
      }, 16);
    </script>
  </body>
</html>
